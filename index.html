<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; img-src 'self' https://www.akfcs.org data:; style-src 'self' 'unsafe-inline'; script-src 'self'; base-uri 'none'; form-action 'none'">
  <meta name="theme-color" content="#f5c6cb" />
  <title>Access Denied</title>
  <style>
    :root {
      --bg: #f8d7da;
      --card: #f5c6cb;
      --border: #f5c2c7;
      --text: #721c24;
      --text-strong: #501319;
      --muted: #5a2b2b;
    }
    html,body{
      height:100%;
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: Arial, sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      box-sizing:border-box;
    }
    main.container{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:12px;
      padding:24px;
      text-align:center;
      max-width:700px;
      width:100%;
      box-sizing:border-box;
    }
    .logo{
      width:120px;
      height:120px;
      object-fit:contain;
      margin-bottom:20px;
    }
    h1{ font-size:1.8rem; margin:0 0 12px; font-weight:bold; }
    .subtitle{ font-size:1.25rem; margin:12px 0; color:var(--muted); }
    .assigned-to{ font-size:1.25rem; font-weight:bold; color:var(--text-strong); margin-top:20px; }
    .serial-row{ display:flex; gap:8px; align-items:center; justify-content:center; margin-top:12px; flex-wrap:wrap; }
    .serial-input{
      font-size:1rem;
      padding:8px 10px;
      border-radius:6px;
      border:1px solid var(--border);
      background: #fff;
      color: #111;
      min-width:220px;
    }
    button.copy-btn{
      padding:8px 12px;
      border-radius:6px;
      border: none;
      cursor:pointer;
      font-weight:600;
      background: transparent;
      color: inherit;
      text-decoration: underline;
    }
    .feedback{
      margin-top:10px;
      font-size:0.95rem;
      color:var(--text-strong);
    }
    a{ color:inherit; text-decoration:underline; }
    @media (max-width:480px){
      h1{ font-size:1.4rem; }
      .subtitle{ font-size:1.1rem; }
      .assigned-to{ font-size:1.1rem; }
      .serial-input{ min-width:160px; }
    }
  </style>
</head>
<body>
  <main class="container" role="main" aria-live="polite">
    <header>
      <img
        src="https://www.akfcs.org/wp-content/uploads/2021/05/abby-kelley-foster-logo.png"
        alt="Abby Kelley Foster Charter Public School logo"
        class="logo"
        loading="lazy"
        decoding="async"
        width="120"
        height="120"
      />
      <h1>üö´ Uh-oh! This Chromebook Belongs to Someone Else!</h1>
      <p class="subtitle">It looks like you‚Äôre trying to sign in on a Chromebook that isn‚Äôt assigned to you.</p>
    </header>

    <section id="assignment" hidden>
      <p id="userInfo" class="assigned-to"></p>
    </section>

    <!-- Serial number section (hidden if no serial param) -->
    <section id="serialSection" hidden aria-labelledby="serialLabel">
      <p id="serialLabel" class="subtitle">Device serial number (copy and send to IT):</p>
      <div class="serial-row">
        <!-- readonly input so users can select & copy; value populated by script -->
        <input id="serialInput" class="serial-input" type="text" readonly aria-label="Chromebook serial number" />
        <button id="copySerialBtn" class="copy-btn" type="button" aria-describedby="copyHint">Copy</button>
      </div>
      <div id="copyFeedback" class="feedback" role="status" aria-live="polite"></div>
    </section>

    <section aria-labelledby="help-title">
      <p id="help-title" class="subtitle">üíª Not sure if this Chromebook is yours?</p>
      <p class="subtitle">Please check the label on your device or ask your teacher for help! üòä</p>
      <p class="subtitle">
        üõ†Ô∏è Still having trouble signing in?
        <a href="mailto:ITsupport@akfcs.org?subject=Chromebook%20Access%20Denied&body=I%20see%20the%20Access%20Denied%20page.%20Device%20label%20or%20serial%3A%20_____%0D%0AUser%20trying%20to%20sign%20in%3A%20_____">
          ITsupport@akfcs.org
        </a>
        can help.
      </p>
    </section>
  </main>

  <script>
    (function () {
      // Read query parameters safely
      const params = new URLSearchParams(window.location.search);
      const user = (params.get("user") || "").trim();
      const serial = (params.get("serial") || "").trim();

      // Elements
      const userInfo = document.getElementById("userInfo");
      const assignment = document.getElementById("assignment");
      const serialSection = document.getElementById("serialSection");
      const serialInput = document.getElementById("serialInput");
      const copyBtn = document.getElementById("copySerialBtn");
      const copyFeedback = document.getElementById("copyFeedback");

      // Show assigned user if present
      if (user) {
        // textContent is safe (no HTML injection)
        userInfo.textContent = `This device is assigned to: ${user}`;
        assignment.hidden = false;
      } else {
        assignment.hidden = true;
      }

      // Show serial if present
      if (serial) {
        // limit the displayed length to a reasonable size to avoid nonsense input
        const displayed = serial.length > 128 ? serial.slice(0, 128) : serial;
        serialInput.value = displayed;
        serialSection.hidden = false;
      } else {
        serialSection.hidden = true;
      }

      // Copy logic (uses Clipboard API with fallback)
      function showFeedback(message) {
        copyFeedback.textContent = message;
        // clear after a short visible period but leave for screen readers
        setTimeout(() => {
          // Only clear visual text (keeps aria-live announcements already announced)
          copyFeedback.textContent = '';
        }, 3000);
      }

      copyBtn.addEventListener('click', async function () {
        const text = serialInput.value;
        if (!text) {
          showFeedback('No serial to copy.');
          return;
        }

        // Modern API
        if (navigator.clipboard && navigator.clipboard.writeText) {
          try {
            await navigator.clipboard.writeText(text);
            showFeedback('Serial copied to clipboard ‚úÖ');
          } catch (err) {
            // fallback to execCommand approach below
            fallbackCopy(text);
          }
        } else {
          fallbackCopy(text);
        }
      });

      // Make the input quick-select when clicked or focused + Ctrl/Cmd+A
      serialInput.addEventListener('click', function () {
        this.select();
      });

      serialInput.addEventListener('focus', function () {
        this.select();
      });

      function fallbackCopy(text) {
        // create a temporary textarea
        const ta = document.createElement('textarea');
        ta.value = text;
        // Move off-screen
        ta.style.position = 'fixed';
        ta.style.left = '-9999px';
        document.body.appendChild(ta);
        ta.select();
        try {
          const ok = document.execCommand('copy');
          if (ok) {
            showFeedback('Serial copied to clipboard ‚úÖ');
          } else {
            showFeedback('Could not copy automatically ‚Äî select and press Ctrl+C (or Cmd+C).');
          }
        } catch (e) {
          showFeedback('Could not copy automatically ‚Äî select and press Ctrl+C (or Cmd+C).');
        } finally {
          document.body.removeChild(ta);
        }
      }

      // Optional: allow copy via keyboard (Enter/Space) on the button
      copyBtn.addEventListener('keydown', function (ev) {
        if (ev.key === 'Enter' || ev.key === ' ') {
          ev.preventDefault();
          copyBtn.click();
        }
      });
    }());
  </script>
</body>
</html>
